---
created: 星期六, 八月 31日 2024, 5:32:21 下午, 1725096741000
modified: 星期六, 八月 31日 2024, 5:32:21 下午, 1725096741000
---


DECK: 算法
## 链式调用
核心就是class，每个方法return this
因为都是`obj.func`调用的，属于隐式绑定，以此实现链式调用

```js
class Person {
    constructor() {
        this.queue = Promise.resolve();
    }
    // 每次在前一个promise queue后面添加了一个then(...)
    // 链式调用时同步构建promise queue链
    eat(something) {
        this.queue = this.queue.then(() => {
            console.log(something);
            return Promise.resolve();
        });
        return this;
    }

    sleep(time) {
        this.queue = this.queue.then(() => {
            return new Promise(resolve => setTimeout(resolve, time));
        });
        return this;
    }
}

// 测试函数
async function testPersonClass() {
    const person = new Person();
    const startTime = Date.now();

    const logWithTimestamp = (message) => {
        const elapsedTime = Date.now() - startTime;
        console.log(`${elapsedTime}ms: ${message}`);
    };

    // 开始测试
    logWithTimestamp("测试开始");

    // 同步构建promise调用链，然后挨个then执行下去
    await person.eat('breakfast').sleep(1000).eat('lunch').sleep(2000).sleep(3000).eat('dinner').queue;

    logWithTimestamp("测试结束");
}

// 运行测试
testPersonClass().then(() => console.log("测试完成"));
```

END
<!--ID: 1726888842882-->
