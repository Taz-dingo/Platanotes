TAG: 浏览器
DECK: 前端
## 同源策略

浏览器为了**请求安全**而引入的基于**同源**的安全特性，只允许当前网页与同一源下的其他资源进行交互，包括读取和修改。
MDN定义：**限制了从一个源加载的文档或脚本如何与另一个源的资源进行交互。**
### 同源策略的意义

>**同源策略**是一个重要的安全策略，它用于限制一个[源](https://developer.mozilla.org/zh-CN/docs/Glossary/Origin)的文档或者它加载的脚本如何能与另一个源的资源进行交互。
>
>它能帮助阻隔恶意文档，减少可能被攻击的媒介。例如，它可以防止互联网上的恶意网站在浏览器中运行 JS 脚本，从第三方网络邮件服务（用户已登录）或公司内网（因没有公共 IP 地址而受到保护，不会被攻击者直接访问）读取数据，并将这些数据转发给攻击者。[^1]

意义：
- 防止网页脚本操作其他页面DOM
- 防止网页脚本获取其他页面数据

值得注意的是，同源策略是**浏览器拦截网页对请求响应的获取**，**请求实际上还是能够发送出去**。

### 这些也是跨域

1. LocalStorage / SessionStorage 跨域
	LocalStorage 和 SessionStorage 同样受到同源策略的限制。而跨域读写的方式也可以使用前文提到的 postMessage。

 2. 跨域与监控
	前端项目在统计前端报错监控时会遇到上报的内容只有 `Script Error` 的问题。这个问题也是由同源策略引起。在 `<script>` 标签上添加 `crossorigin="anonymous"` 并且返回的 JS 文件响应头加上 `Access-Control-Allow-Origin: *` 即可捕捉到完整的错误堆栈。

3. 跨域与图片
	前端项目在图片处理时可能会遇到图片绘制到 Canvas 上之后却不能读取像素或导出 base64 的问题。这个问题也是由同源策略引起。解决方式和上文相同，给图片添加 `crossorigin="anonymous"` 并在返回的图片文件响应头加上 `Access-Control-Allow-Origin: *` 即可解决。


[^1]: [浏览器的同源策略](https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy)


END
<!--ID: 1723557816956-->


