---
created: 星期四, 十月 10日 2024, 3:56:19 下午, 1728546979611
modified: 星期四, 十月 10日 2024, 3:56:19 下午, 1728546979611
---

TAG: React
DECK: 前端 
## 空闲调度
React Fiber 没有直接使用 `requestIdleCallback` 而是实现了自己的空闲调度，主要有以下几个原因：
1. 更精确（确定性、细粒度）地控制任务的执行时间和优先级
2. 提供更好的跨平台兼容性
3. 保证用户界面的流畅性和高效响应


---

1. **`requestIdleCallback` 的不确定性**：
   - `requestIdleCallback` 是浏览器在空闲时执行的回调，但它的触发时机并不可靠，尤其**在资源紧张或高负载的情况下，可能会被延迟或不触发**。这对 React 来说可能无法满足需要及时更新界面的需求。
   - React Fiber 的目标之一是让用户界面更加平滑和响应式，需要能够在特定的时间片内执行工作，而不是等待浏览器的空闲时间。

2. **更细粒度的控制**：
   - React Fiber 实现了自定义的调度系统，能够以更细粒度地控制任务的优先级和执行顺序。不同优先级的任务（如用户输入、动画、低优先级的渲染更新等）可以根据紧急程度被调度，而 `requestIdleCallback` 只能**处理低优先级的任务，无法控制这种优先级的精细划分**。
   - React Fiber 能够根据不同任务的紧迫性来中断或恢复任务执行，而 `requestIdleCallback` 则不具备这种灵活性。

3. **跨平台的兼容性**：
   - `requestIdleCallback` 并不是在所有环境下都支持或一致，尤其是移动端的浏览器和服务器端（如 SSR 环境）可能不支持这个 API。而 React 的调度系统需要能够在所有平台上工作，因此需要一种更具一致性的方法。
   - React Fiber 实现的调度机制不依赖浏览器特定的 API，能够确保在各种环境下都能以预期的方式工作。

4. **处理高优先级任务**：
   - Fiber 调度器可以在当前帧执行中优先处理高优先级任务，比如用户交互或动画，而无需等待浏览器的“空闲”时间。自定义调度系统使 React 能够更好地响应用户的输入，提升应用的整体体验。


END
<!--ID: 1728866780428-->
