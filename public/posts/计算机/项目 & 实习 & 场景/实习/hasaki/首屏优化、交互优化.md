---
created: 星期五, 八月 30日 2024, 4:08:52 下午, 1725005332000
modified: 星期五, 八月 30日 2024, 4:08:52 下午, 1725005332000
---


### [[首屏优化]]
S：头像商城首页长列表，展示各种不同类型的头像

T：首屏加载优化

A：
排查思路：
Perfomance面板里查看各个[[前端性能指标]]时长，根据不同类型进行不同的优化策略。
- loading 网络加载
	1. 打包压缩。css、js压缩合并；小图片从请求转化为base64编码；打包后进一步压缩，比如gzip
	2. 使用优化格式。比如图片使用webp
	3. 优化缓存策略。合理分包，业务和公共代码分离
	4. 静态资源上CDN。
	5. 不重要资源延迟加载、懒加载
- scripting 脚本执行
	1. 计算拆分。长任务拆分后延迟加载or懒加载。
	2. 减少不必要的计算。
- rendering 重排
	1. 减少布局修改频率（通过requestAnimation）
	2. 减少强制同步重排（获取offsetXXX、scrollxxx等等会触发强制同步重排）
	3. 使用优化属性transform、opacity等
- painting 重绘
	一般很少成为性能瓶颈
- 最后是用户体验优化
	1. 内联关键css，更快看到关键内容
	2. 骨架屏，减少FCP时间

网络部分主要关注了FP。压缩、优化格式、CDN基建都做好了。排查发现有一个bundle特别大发生阻塞了，进一步用analyzer分析发现业务代码和公共库代码糅合在一起，于是进行分包。这样客户端加载的时候只会重新获取变动频繁的少量业务代码，大体积的bundle直接缓存。
	脚本执行部分，发现整个长列表都在一个任务里加载，阻塞了交互，造成卡顿的感受。于是按照头像分类进行拆解，拆解部分使用的是延迟加载的思路，这样既不会阻塞页面和交互，又能快速加载剩余部分（懒加载的话由于是即时响应，可能导致局部白屏）。


R：
本地对比测试，FCP时长减少30%


---

### 交互优化
S：有一个tab点击跳转到对应高度，跳转的时候非常卡，显然不正常。

T：
依旧用之前的排查思路。
首先发现点击事件后整个滚动过程非常卡，看火焰图发现主要是脚本执行、布局渲染时长，底下是一堆fiber之类的东西，猜测应该是组件渲染相关的，再排查代码，发现是触发了主内容组件的重新渲染，用useMemo包之。
1. 高频触发布局同步
2. 子组件重新渲染


A：

R：



