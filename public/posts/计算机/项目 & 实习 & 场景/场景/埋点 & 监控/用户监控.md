TAG: 
DECK: 前端
## 用户监控

### 行为监控
- 点击触发埋点 - 可以立即发送点击事件的数据到服务器。
- 页面停留时间上报埋点 - 可以在路由变化时发送页面停留时间。
- 内容可见埋点 - 可以利用IntersectionObserver API监听元素可见性变化。
- 退出页面：
	判断用户可能要退出页面可以通过以下几种方法：
	1. beforeunload、unload事件
	2. visibilitychange事件
	3. mousemove结合防抖

### 性能监控

要监控用户的白屏时间、页面加载速度等信息，可以使用以下几种方法：
- Performance API+上报
- 浏览器Perfomance、Lighthouse工具，本地自测

---
### 退出页面监测

#### 1. 使用 `beforeunload` 事件、监听 `unload` 事件
可以监听 `beforeunload` 事件，这个事件在用户离开页面之前触发。您可以在这个事件中执行数据上报。

```javascript
window.addEventListener('beforeunload', (event) => {
  // 在此处上报性能数据
  sendPerformanceData({
    // 包含需要上报的数据
  });

  // 可选：显示确认离开的提示
  event.returnValue = '';
});
```


```javascript
window.addEventListener('unload', () => {
  sendPerformanceData({
    // 上报数据
  });
});
```
#### 2. 监听页面的失去焦点
使用 `visibilitychange` 事件可以监控页面的可见性状态，判断用户是否切换到其他标签页或最小化浏览器。

```javascript
document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'hidden') {
    // 页面不可见，可能是用户要离开
    sendPerformanceData({
      // 上报数据
    });
  }
});
```

#### 3. 使用时间阈值
结合用户在页面上的停留时间，可以设定一个时间阈值，当用户在页面上停留超过一定时间后，再考虑上报。

```javascript
let timer;
window.addEventListener('mousemove', () => {
  clearTimeout(timer);
  timer = setTimeout(() => {
    // 如果用户在此时间后仍未活动，可以上报
    sendPerformanceData({
      // 上报数据
    });
  }, 30000); // 例如，30秒
});
```

### 性能监控
#### 使用 Performance API
浏览器的 Performance API 提供了多种方法来获取页面加载的性能数据。

```javascript
// 获取页面加载时间
window.addEventListener('load', () => {
  const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
  console.log(`页面加载时间: ${loadTime} 毫秒`);
});

// 获取白屏时间
const whiteScreenTime = performance.timing.responseEnd - performance.timing.navigationStart;
console.log(`白屏时间: ${whiteScreenTime} 毫秒`);
```

#### 利用 Lighthouse、Perfomance工具（本地自测）
Lighthouse 是一个开源工具，可以分析网站的性能，包括页面加载速度、白屏时间等。可以在 Chrome 开发者工具中找到并使用。



END
