
TAG: 场景
DECK: 前端
## 页面状态保存
如果是简单的状态保存，`localStorage` 或 URL 参数足够。如果状态比较复杂，IndexedDB 或服务端存储可能更适合。如果你使用 React 等框架，可以结合状态管理库来简化存储逻辑。

---

### 1. **使用 `localStorage` 或 `sessionStorage`**
   - **`localStorage`**：保存数据到浏览器中，即使刷新或关闭浏览器再打开，数据仍然保留，直到手动清除或代码中移除。
   - **`sessionStorage`**：只在当前浏览器会话中保留数据，关闭浏览器标签页后数据会被清除。

   示例：
   ```js
   // 保存状态到 localStorage
   const saveState = (key, state) => {
     localStorage.setItem(key, JSON.stringify(state));
   };

   // 从 localStorage 中恢复状态
   const loadState = (key) => {
     const savedState = localStorage.getItem(key);
     return savedState ? JSON.parse(savedState) : null;
   };

   // 使用示例
   const state = { name: 'Alice', age: 25 };
   saveState('userState', state);
   
   const loadedState = loadState('userState');
   console.log(loadedState); // { name: 'Alice', age: 25 }
   ```

### 2. **将状态保存在 URL 参数中**
   你可以使用 URL 查询参数或哈希参数来保存页面状态，并通过解析 URL 在刷新后恢复状态。

   示例：
   ```js
   // 生成带状态的 URL
   const setStateInUrl = (state) => {
     const params = new URLSearchParams(state);
     window.history.replaceState(null, '', `?${params}`);
   };

   // 从 URL 中获取状态
   const getStateFromUrl = () => {
     const params = new URLSearchParams(window.location.search);
     return {
       name: params.get('name'),
       age: params.get('age'),
     };
   };

   // 使用示例
   const state = { name: 'Alice', age: 25 };
   setStateInUrl(state);
   
   const loadedState = getStateFromUrl();
   console.log(loadedState); // { name: 'Alice', age: '25' }
   ```

### 3. **使用 IndexedDB**
   如果你需要保存更多复杂的结构化数据，可以使用浏览器的 `IndexedDB`。

### 4. **借助服务端存储**
   如果你有用户登录系统，可以将状态保存到服务器端，比如数据库中。当用户刷新页面时，通过 API 调用获取状态并恢复。

   示例：
   ```js
   // 假设使用 fetch API 从服务端获取用户状态
   const fetchStateFromServer = async () => {
     const response = await fetch('/api/get-user-state');
     const data = await response.json();
     return data;
   };
   ```

### 5. **结合 React 状态管理库**
   如果你使用 React，状态管理库如 `Zustand`、`Redux-Persist` 可以自动将状态同步到 `localStorage` 或 `sessionStorage`。

   示例（Zustand + localStorage）：
   ```js
   import create from 'zustand';
   import { persist } from 'zustand/middleware';

   const useStore = create(
     persist(
       (set) => ({
         name: 'Alice',
         age: 25,
         updateName: (newName) => set({ name: newName }),
       }),
       {
         name: 'userState', // 存储的键
         getStorage: () => localStorage, // 使用 localStorage
       }
     )
   );
   ```

END
<!--ID: 1728866780403-->
